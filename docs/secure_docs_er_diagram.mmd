erDiagram
    %% ===== CORE TABLES =====
    users {
        bigint id PK
        varchar name
        varchar email UK
        timestamp email_verified_at
        varchar password
        varchar remember_token
        timestamp created_at
        timestamp updated_at
        text two_factor_secret
        text two_factor_recovery_codes
        timestamp two_factor_confirmed_at
        boolean is_approved
        varchar role
        boolean is_premium
        bigint current_team_id
        varchar profile_photo_path
    }

    files {
        bigint id PK
        bigint user_id FK
        varchar file_name
        varchar file_path
        varchar file_size
        varchar file_type
        varchar mime_type
        timestamp created_at
        timestamp updated_at
        bigint parent_id FK
        boolean is_folder
        timestamptz deleted_at
        varchar blockchain_provider
        varchar ipfs_hash
        text blockchain_url
        boolean is_blockchain_stored
        json blockchain_metadata
        boolean is_vectorized
        timestamptz vectorized_at
    }

    documents {
        bigint id PK
        text content
        jsonb metadata
        vector embedding
        bigint user_id
        bigint file_id FK
    }

    document_metadata {
        text id PK
        text title
        text url
        timestamp created_at
        text schema
        bigint user_id
        bigint file_id FK
    }

    document_rows {
        integer id PK
        text dataset_id FK
        jsonb row_data
        bigint file_id FK
    }

    %% ===== BLOCKCHAIN TABLES =====
    blockchain_configs {
        bigint id PK
        bigint user_id FK
        varchar provider
        text api_key_encrypted
        json settings
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    blockchain_uploads {
        bigint id PK
        bigint file_id FK
        varchar provider
        varchar ipfs_hash
        varchar upload_status
        text error_message
        numeric upload_cost
        json provider_response
        timestamp created_at
        timestamp updated_at
    }

    %% ===== ACTIVITY TRACKING TABLES =====
    system_activities {
        bigint id PK
        bigint user_id FK
        bigint target_user_id FK
        bigint file_id FK
        varchar activity_type
        varchar action
        varchar entity_type
        bigint entity_id
        text description
        jsonb metadata
        inet ip_address
        text user_agent
        varchar session_id
        varchar location_country
        varchar location_city
        varchar device_type
        varchar browser
        varchar risk_level
        boolean requires_audit
        boolean is_suspicious
        timestamp created_at
    }

    file_access_logs {
        bigint id PK
        bigint file_id FK
        bigint user_id FK
        varchar session_id FK
        varchar access_type
        varchar access_method
        bigint file_size_at_access
        varchar file_version_at_access
        inet ip_address
        text user_agent
        text referrer
        integer response_time_ms
        bigint bytes_transferred
        timestamp started_at
        timestamp completed_at
        integer duration_seconds
    }

    daily_activity_stats {
        bigint id PK
        bigint user_id FK
        date date
        integer files_created
        integer files_updated
        integer files_deleted
        integer files_accessed
        integer login_count
        bigint storage_used_bytes
        bigint bandwidth_used_bytes
        integer session_count
        integer active_time_minutes
        integer unique_files_accessed
        timestamp created_at
        timestamp updated_at
    }

    %% ===== SEARCH & UI TABLES =====
    saved_searches {
        bigint id PK
        bigint user_id FK
        varchar name
        text query
        jsonb filters
        varchar sort_by
        varchar sort_order
        boolean is_default
        boolean is_shared
        timestamp created_at
        timestamp updated_at
    }

    search_logs {
        bigint id PK
        bigint user_id FK
        varchar session_id
        text query
        jsonb filters_used
        integer result_count
        integer search_time_ms
        inet ip_address
        text user_agent
        text referrer
        timestamp created_at
    }

    notifications {
        bigint id PK
        bigint user_id FK
        varchar type
        varchar title
        text message
        jsonb data
        timestamptz read_at
        timestamptz created_at
        timestamptz updated_at
    }

    %% ===== SECURITY & AUTHENTICATION TABLES =====
    user_sessions {
        bigint id PK
        bigint user_id FK
        varchar session_id UK
        inet ip_address
        text user_agent
        text device_fingerprint
        varchar location_country
        varchar location_city
        varchar location_timezone
        boolean is_active
        timestamp last_activity_at
        varchar login_method
        boolean is_suspicious
        boolean trusted_device
        timestamp created_at
        timestamp expires_at
        timestamp logged_out_at
    }

    webauthn_credentials {
        text id PK
        text raw_id
        jsonb response
        varchar type
        array transports
        varchar attestation_type
        jsonb trust_path
        uuid aaguid
        text public_key
        bigint counter
        text user_handle
        text user_id
        varchar authenticatable_type
        bigint authenticatable_id
        timestamptz disabled_at
        timestamptz created_at
        timestamptz updated_at
        text rp_id
        text origin
        varchar alias
        varchar attestation_format
    }

    password_reset_tokens {
        varchar email PK
        varchar token
        timestamp created_at
    }

    personal_access_tokens {
        bigint id PK
        varchar tokenable_type
        bigint tokenable_id
        varchar name
        varchar token UK
        text abilities
        timestamp last_used_at
        timestamp expires_at
        timestamp created_at
        timestamp updated_at
    }

    sessions {
        varchar id PK
        bigint user_id FK
        varchar ip_address
        text user_agent
        text payload
        integer last_activity
    }

    %% ===== CHAT & COMMUNICATION TABLES =====
    chat_histories {
        integer id PK
        varchar session_id
        jsonb message
    }

    %% ===== SYSTEM & FRAMEWORK TABLES =====
    cache {
        varchar key PK
        text value
        integer expiration
    }

    cache_locks {
        varchar key PK
        varchar owner
        integer expiration
    }

    jobs {
        bigint id PK
        varchar queue
        text payload
        smallint attempts
        integer reserved_at
        integer available_at
        integer created_at
    }

    job_batches {
        varchar id PK
        varchar name
        integer total_jobs
        integer pending_jobs
        integer failed_jobs
        text failed_job_ids
        text options
        integer cancelled_at
        integer created_at
        integer finished_at
    }

    failed_jobs {
        bigint id PK
        varchar uuid UK
        text connection
        text queue
        text payload
        text exception
        timestamp failed_at
    }

    migrations {
        integer id PK
        varchar migration
        integer batch
    }

    %% ===== RELATIONSHIPS =====
    users ||--o{ files : owns
    users ||--o{ blockchain_configs : configures
    users ||--o{ system_activities : performs
    users ||--o{ file_access_logs : accesses
    users ||--o{ daily_activity_stats : generates
    users ||--o{ saved_searches : saves
    users ||--o{ search_logs : searches
    users ||--o{ notifications : receives
    users ||--o{ user_sessions : creates
    users ||--o{ webauthn_credentials : owns
    users ||--o{ personal_access_tokens : owns

    files ||--o{ files : contains
    files ||--o{ documents : vectorizes
    files ||--o{ document_metadata : describes
    files ||--o{ document_rows : populates
    files ||--o{ blockchain_uploads : uploads
    files ||--o{ system_activities : affects
    files ||--o{ file_access_logs : accessed

    document_metadata ||--o{ document_rows : contains

    user_sessions ||--o{ file_access_logs : tracks

    sessions }o--|| users : authenticates
